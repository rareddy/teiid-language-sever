language: java
cache:
  directories:
  - "$HOME/.m2"
branches:
  except:
    - /^dependabot.*$/
jobs:
  include:
    - stage: test
      jdk: openjdk8
      script:
        - mvn verify
    - stage: test
      jdk: openjdk11
      script:
        - mvn verify
    - stage: test
      jdk: openjdk14
      script:
        - mvn verify
    - stage: deploy
      name: "Sonar analysis"
      jdk: openjdk11
      before_install: "export VERSION_SUFFIX=`grep '<version>' pom.xml -m 1 | cut -d'>' -f 2 | cut -d'<' -f 1 | cut -d'-' -f 2`"
      script:
        - if [[ $VERSION_SUFFIX == "SNAPSHOT" ]]; then
          export IS_SNAPSHOT=true;
         else
          export IS_SNAPSHOT=false;
         fi
        - if [[ $TRAVIS_PULL_REQUEST == "false" && $TRAVIS_BRANCH == "master" && $IS_SNAPSHOT == "true" || -n "$TRAVIS_TAG" && $IS_SNAPSHOT == "false" ]]; then 
            mvn verify -Dtest="*,!RunnerStandardIOTest,!RunnerWebSocketTest" -B sonar:sonar;
          fi
        - if [[ $TRAVIS_PULL_REQUEST == "false" && $TRAVIS_BRANCH == "master" && $IS_SNAPSHOT == "true" ]]; then
         ./.travis/before-deploy.sh;
         ./.travis/deploy.sh;
         elif [[ -n "$TRAVIS_TAG" && $IS_SNAPSHOT == "false" ]]; then
         ./.travis/before-deploy.sh;
         ./.travis/deploy.sh;
         fi          
      addons:
        sonarcloud:
          organization: "teiid"
          token:
            secure: "TggRuDyFbjFNts8bBcoQhVq9a8dAiEN0Y/JqHfprksA+ekvJ7MLhfQCNFCHnWVdCAOCX00jNOrDR/nKLLV7NsCxVGZINYN17Ls4zfYPGXk6hmGAX+E58XM8cBhS/tKO8YSw3mL/L0n8saKOsANwGubUIu4pcUVnAYx2BfhYDcznEUT2NDLhZOc4ZNQdq2fKBgi4vlUVieonqEcdCPpTDIVglqlZZcufiBwtdLKwQN89L4MT+351JkVFiz6JjDTUManmnvkdGP7lL62YJVWH87DsEvxTJlWPBeTslG++yv7ctgeD7AalmkU/WZZ8ycChQORSn6mKB3uKIFQQubyeUPUwGFwBUMy8jcOXCGYcThPSfbPaK4NFUySdPrLKqU5lsDhqf/eXqj2KIqPjxBm0QI2/RQdyjWYLKvqf0Eo1TtetDNA74xM1gpKyh/UsXD5Lfkp3JtLlzgTY1nph/q4A+8aJq/WEFJade4AAQpxa4wqUW7TnY5z1te01z+yvnYdE/Lov7FgVZ3Iy37jBqZYAzwlkGpFFLltgrmpaPyuM31w2Cp/+v+qYuGj41EZm8AcnbhttlnWc+xed6q9sItKCdH33hLpXiH9AHTp2elulV1s062wDe9/gIKHeMV3K7dSpf5BIGXWogjDo2+DFr/NKKIIY7P5fWFXU+W3QxWCmN4hU="
stages:
 - test
 - name: deploy
   if: branch = master AND NOT type = pull_request
env:
  global:
  - secure: CVgUFV84mm7Jmi3PFOh4OWNEa5NzIBOSLEQys6gF5eb4Y36cCtbfWrKr2bBC5ZvCg0yFvlc4xhk4Q2InTN4jXBKolNf9OAwfuEDsFveiQ2UJI1+5gL+P84DXpkEeTKB1x6nFFUWmvXqe2juw3rtq9i8SZrSUV8zL63rUKkry1yoRvgsSevGRSXL8p3KCi68HWax+oAbMUPPn4Lvc1xToZGGPHSe8dJV0g/Lty24266IbXdJyHYG0ylYd41FiJpeMJ7QREl+CkdYi4DnUEE3ZUTBVYRn2gTebgtuay7tyhA70TbYhmkxprSrQvm10VgOuH0Nab+xZqBR+UosAZsGzq9K2dgc9CMZ3oVjft0K6MKmDBUdH2L5WKODUgV1/4ZwuW+lSsEYUFH4jBXihveS1k0+mPShc3m/F7s4olUcX8050fAB+ctm4E8detyBJdiqdcnBIOaQWm/eaXdHPaCIiMG4dMMMdrA+rXmqIsk6UtO76Qsuhy7mEJyhGkwrVqGRlI5okqGRBasLhzPgVx4w1fXinYe0ZgF1URGAHdTVY0lZP5ePTgnRlICkkeVBnjtsgxv20RVevGcgomWzDwnO8R9GQ+zOrv7UcK/5rJfcH5wYkG2OR6ZFRRidglQKqYzGDdzrXkOCwua8FiiMc+TmNx34c5AXvtRE5WkWbzbC1Jdc=
  - secure: DErj3W4+pSEPOC+ThWhDzB4JNU/mrFgmx0XhmafQMtXKctGdXcwObiFSJrhauqPmQYJ37Tm1bqSNRrB9EKHRbMISHkjDizh70hB7QA6CUxgZUh57oZ9CxHtHhGO2kQ4+ftnuWfbFL/kQXWygy9gLuqdabzqcow+WF86h/RNbVXSBjibk1WPnj+Q4DS8LjhrZ3VrUlLEcQ/ORO1cdqVYPeF4Qn+gD77kzXEc1+EpRIqFgaDCQHBFCfxGskXfSOcRdP7owPUHTKMNIekolEFCn+/2Xwas/E1CvBVeMOxA5TDaUcLQbPLtxFlLPYa26itMUYktVBXJOkR+QIp7AHAW57eNXUE2ez+y+YclGma2YdteFaA29umJURjsTZiUu5oCrY9H2qwCFni7iLGeoK9CFC6tUnWVGGSa2hag+tbTquxdx099aWOco9BZBNzFqNNbi5Hi6u0LCLZB5NJOmA8yZ7yGHtf9LPSJviRz0Q8QwQCTrq3NmPgCDLLG7ZMt0XUF+9DtFnLdwkwLTbIYVMlKqXyId/IYjWvbSXsi5MIyoqEHj99oDjym4LhDkeFv9vzjOGGwq4caaFAMvDbzG0xLKHpbgD+DIi7Rr6y4OobLndvMIJ8S3AyGZlA5f7Frn4BT8VCtcToBOgxcwB/sKeXGDCekqCo6q7+zfNcLBMfaC4qY=
  - secure: M0wtGt24DzVdxXEyfPsRfe5w9QOHjDcngLKlB2OuBLrbdZuAoKtVxw+Ff5JA6bSUiMLQX/uCt/1ZnyiP+OhgUgmUa84rihUKl3IuN5rzRkxr8mZ1sp1dG3QnAohDcLvfEWMGXby0MpWUBB+dNYGVPZ2CgOXqtiQkLCR0HtRGXQv/VRvEttHvEIBfwRZzM7h+jxEJcMa2bIn5PBml5shqkb9r9mduARxKFLZ4n13ziW+H9S2wEm99EICY2BLHn6+4niZxyKwXoRMcLkbf2FO2uSLEOne71IKXPZ0oPdQ+xcohz25Zo3HsD/LZFq7mojyxdNpym9chaFFQpK2yPXZQJ7FX6xsbIfrt7OwwrdHFyZe2kSucSWW+KGrG43GDCBnWGiWt3wTIHkDEhsAUR0PYM/rZPbRbM61/fWGK/OIhAMWSu6DQDi/Uyk5wXufFnlgz6hJk+O3wmiIBoQh9+BAesgpit2B+hwJGimE4hO3TGIOmu0aCQ82d+ua9k01eH/CYgjxRAehZth2EEdI8M0RRGRVkPjxfg48i5AehJYU13DkSXuhAT5+6JKJJzU+LUxyR+3/8UHUcB13EyHqnwNrWRl4ISfPGnNkk7LE0RLajXLOuq5B8V2+jBPNwukxryTa9+Z35KT0dL8VZtNq9agyWDv1YwgHzJxbPGkY/Jgt/pMo=
  - secure: jHbDctsESkFdBJa/Zc87zELNB/xTVa7Xsrds0B8/aiYUAgF7lDUHtgTlpRy5pMrItBmRwcmaQ0S2ti0p9IsMtZJnzmfh5HDzzR4D6dZn5nhNFdZ3d6IzqCiEWZD+2LNMLOGnqoJprcmQFVK7OuPvgU/TaZ8D8MABFekuuLb1wDYX1a4YIBlMDDwYsyVlNtoN6CX/g2XRZClLj/8I744Gh1f089QZiMOpgtSHrtZfoEiQL0muv/W+35DhWOoJ3tzm63wV92bvj4S+U5tgfHNWV51gJ3j9eYbGflZhQXnB+uCMZotXLvQyYA7TexH4eLIyj3BmUbBczjDTj05ttnJBOH03ud5SjAoPuclCcT/rWnfzGQGJ2RCWXM3gwgDpFPdN/fHQ6jrihrQRBfxw4AqkpPzk3Ce1YDVyCBBaYlrwowoYChmrBfIttHUbYTGZe1pNsmYzP2H8tTbOvnWNpEu5eaQOMEtaJdjWx2oAnk+hQkrDeGNq5vuKLlBwihT4D+8n8aqOCpQLe7DDiLjKRemYoOfHK3uwAebMBCfod1zoTzh9E+J0i7EX294HaG5SKFgPk4ujWZv+OgIqNhvAuViM2ZJxjhENHCJmYPrZXKsg8D3FQBhd6YXzPFHX2naiHC1J9qTWT2fxzvxtuOpLmUQm+PKcXuRdJY48oVHnJQnskdU=
   
